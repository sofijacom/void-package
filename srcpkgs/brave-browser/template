# Template file for 'brave-browser'
pkgname=brave-browser
version=1.84.132
revision=1
archs="x86_64"
makedepends="unzip"
short_desc="Fast, private and secure web browser with ad blocker"
maintainer="Rickard <@>"
license="Mozilla Public License Version 2.0"
homepage="https://www.brave.com/"
changelog="https://www.brave.com/latest/"
distfiles="https://github.com/brave/brave-browser/releases/download/v${version}/brave-browser-${version}-linux-amd64.zip"
checksum=1e6ff466f8ed360a540775d33ce3e9e08927c8286476f10a44cdc74e213f92ca

do_extract() {
  unzip "${XBPS_SRCDISTDIR}/${pkgname}-${version}/brave-browser-${version}-linux-amd64.zip" -x "cron/*" -d ${wrksrc}
}

do_install() {
  install -dm755 "${DESTDIR}/opt/brave.com/brave" "${DESTDIR}/usr/bin" "${DESTDIR}/usr/share/applications" "${DESTDIR}/usr/share/icons/hicolor" "${DESTDIR}/usr/share/licenses/brave-browser" "${DESTDIR}/usr/share/pixmaps"

  vinstall "${FILESDIR}/brave-browser.desktop" 644 usr/share/applications/
  vinstall "${FILESDIR}/com.brave.Browser.desktop" 644 usr/share/applications/

  vcopy * opt/brave.com/brave

  chmod 0755 "${DESTDIR}/opt/brave.com/brave/brave-browser"
  ln -sf /opt/brave.com/brave/brave-browser ${DESTDIR}/usr/bin/brave-browser

  chmod 4755 "${DESTDIR}/opt/brave.com/brave/chrome-sandbox"

# Follow https://wiki.freepascal.org/Debian_package_structure#usr/share/pixmaps_directory and https://wiki.freepascal.org/Debian_package_structure#usr/share/hicolor_directory
  vinstall product_logo_48.png 644 usr/share/pixmaps brave-browser.png
  for size in 16 24 32 48 64 128 256; do
    install -d ${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps
    vinstall product_logo_${size}.png 0644 usr/share/icons/hicolor/${size}x${size}/apps brave-browser.png
  done
}

post_install() {
  vlicense LICENSE
}
