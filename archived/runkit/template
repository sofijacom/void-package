# Template file for 'runkit'
pkgname=runkit
version=1.4.0
revision=1
build_style=cargo
hostmakedepends="pkg-config rustup"
makedepends="gtk4-devel libadwaita-devel glib-devel pango-devel"
depends="dbus polkit"
short_desc="Graphical manager for runit services"
maintainer="zenobit <zenobit@disroot.org>"
license="MIT"
homepage="https://github.com/Letdown2491/runkit"
changelog="https://raw.githubusercontent.com/Letdown2491/runkit/refs/heads/main/CHANGELOG.md"
distfiles="https://github.com/Letdown2491/runkit/archive/refs/tags/v${version}.tar.gz"
checksum=63c49259d086e1830baee12aa47e5f7ad7bdf1ded98e377d5b9b347bf73065cf

do_build() {
    cargo build --release
}

do_install() {
    # icons
    for size in 16x16 24x24 32x32 48x48 64x64 96x96 128x128 256x256 512x512; do
        vinstall "assets/icons/hicolor/${size}/apps/runkit.png" 644 "usr/share/icons/hicolor/${size}/apps"
    done

	# icons scalable
    vinstall assets/icons/hicolor/scalable/apps/runkit.svg 644 usr/share/icons/hicolor/scalable/apps

    # desktop file
    vinstall assets/applications/tech.geektoshi.Runkit.desktop 644 usr/share/applications

    # dbus service
    vinstall assets/dbus-1/services/tech.geektoshi.Runkit.service 644 usr/share/dbus-1/services
    vinstall assets/dbus-1/system-services/tech.geektoshi.Runkit1.service 644 usr/share/dbus-1/system-services
    vinstall assets/dbus-1/system.d/tech.geektoshi.Runkit1.conf 644 etc/dbus-1/system.d

    # polkit policy
    vinstall assets/polkit-1/actions/tech.geektoshi.Runkit.policy 644 usr/share/polkit-1/actions

	# Install (runkit , runkitd , services-merge)
    vmkdir usr/libexec
	vinstall target/release/runkit 755 /usr/libexec
    vinstall target/release/runkitd 755 /usr/libexec
    vinstall target/release/services-merge 755 /usr/libexec
}

post_install() {
	# service descriptions
    vinstall assets/config/services.json 755 /usr/share/runkit/

    # Remove
    rm -rf ${DESTDIR}/tmp

    # readme
    vdoc README.md

    # license
    vlicense LICENSE
}
