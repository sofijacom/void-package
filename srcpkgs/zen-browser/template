# Template file for 'zen-browser'
pkgname=zen-browser
version=1.17.3b
revision=1
archs="x86_64"
hostmakedepends="binutils tar xz curl"
short_desc="Experience tranquillity while browsing the web without people tracking you!"
maintainer="Rickard <@>"
license="MPL-2.0"
homepage="https://www.zen-browser.app/"
changelog="https://github.com/zen-browser/desktop/releases"
distfiles="https://github.com/zen-browser/desktop/releases/download/${version}/zen.linux-x86_64.tar.xz"
checksum=af6769492f8179f30d681c17777de1da79a6b1a44c97a1cb6a0340d497b19eb7

do_install() {
  install -dm755 "${DESTDIR}/opt/${pkgname}" "${DESTDIR}/usr/bin" "${DESTDIR}/usr/share/applications" "${DESTDIR}/usr/share/pixmaps"

  vinstall "${FILESDIR}/zen.desktop" 0644 usr/share/applications/

  vcopy * "opt/${pkgname}"

  ln -sf "/opt/${pkgname}/zen" "${DESTDIR}/usr/bin/zen"

  # install policies files
  install -dm755 "${DESTDIR}/opt/${pkgname}/distribution"
  vinstall ${FILESDIR}/policies.json 644 "opt/${pkgname}/distribution/"

# Follow https://wiki.freepascal.org/Debian_package_structure#usr/share/pixmaps_directory and https://wiki.freepascal.org/Debian_package_structure#usr/share/hicolor_directory
  vinstall browser/chrome/icons/default/default48.png 0644 usr/share/pixmaps zen-browser.png
  for size in 16 32 48 64 128; do
    install -d ${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps
    vinstall browser/chrome/icons/default/default${size}.png 0644 usr/share/icons/hicolor/${size}x${size}/apps zen-browser.png
  done

  # using system dictionary
  ln -Ts /usr/share/hunspell "${DESTDIR}/opt/${pkgname}/dictionaries"
  ln -Ts /usr/share/hyphen "${DESTDIR}/opt/${pkgname}/hyphenation"
  ln -sf /usr/lib/libnssckbi.so "${DESTDIR}/opt/${pkgname}/libnssckbi.so"
}

post_install() {
  curl --fail -sOL https://raw.githubusercontent.com/zen-browser/desktop/refs/heads/stable/LICENSE
  vlicense LICENSE
}
