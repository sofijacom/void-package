# Template file for 'google-chrome'
pkgname=google-chrome
version=141.0.7390.76
revision=1
_channel=stable
archs="x86_64"
hostmakedepends="curl tar xz python3 python3-html2text python3-setuptools"
depends="gtk+3 alsa-lib libcups xssstate libXtst liberation-fonts-ttf xdg-utils"
short_desc="The popular web browser by Google (Stable Channel)"
maintainer="Sofiya <sofiya@google-chrome.ru>"
license="custom:chrome"
homepage="https://www.google.com/chrome"
nostrip=yes
restricted=yes
repository=nonfree

_baseUrl="https://dl.google.com/linux/chrome/deb/pool/main/g/google-chrome-${_channel}/google-chrome-${_channel}_${version}-1_amd64.deb"
_filename="google-chrome-${_channel}_${version}-1_amd64.deb"
_googleUrl="${_baseUrl}/${_filename}"
_licenseUrl="https://policies.google.com/terms"

distfiles="$_googleUrl"
checksum=612bc3748d538dd567f0480a529538716a451210731c4d30e04abbc5905e05c7

do_extract() {
	mkdir -p ${DESTDIR}
	ar x ${XBPS_SRCDISTDIR}/google-chrome-${version}/${_filename}
}

do_install() {
	tar xf data.tar.xz -C ${DESTDIR}

	# Install the icons
	for size in 16 24 32 48 64 128 256 512; do
		# Create the google-chrome xdg directory
		mkdir -p ${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps

		# Copy the yandex browser icon
		mv ${DESTDIR}/opt/google/chrome/product_logo_${size}.png \
		   ${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps/google-chrome.png
	done

	# Remove the Debian Cron job, duplicate product logos and menu directory
	rm -rf ${DESTDIR}/etc/cron.daily
	rm -rf ${DESTDIR}/opt/google/chrome/cron
}

post_install() {
	curl ${_licenseUrl} | html2text >> google-chrome-eula.md
	vlicense google-chrome-eula.md
}
